import{t as M,a as R,c as ge}from"../chunks/CCffF_dx.js";import"../chunks/pQKmamG3.js";import{k as ee,m as re,p as Me,q as ce,h as D,z as Re,as as Le,b as $e,at as Oe,a1 as be,au as Z,$ as ae,ab as de,ao as Be,av as ke,c as He,a8 as _e,d as pe,a9 as j,ap as qe,g as G,N as y,ae as We,a6 as Ge,a7 as Ee,y as xe,x as oe,A as Ve,aw as se,F as Se,ax as Ye,ay as ze,D as Ke,az as Qe,f as Xe,aA as Je,aB as Ze,v as je,o as er,aC as rr,a5 as ar,aD as tr,aE as nr,a as or,an as sr,J as he,S as P,aq as U,U as C,T as F,R as Q,K as ye,a2 as b,Q as Te,i as te,aF as lr}from"../chunks/Cwc0v4sV.js";import{d as Ue,s as X}from"../chunks/3vagmRDR.js";import{p as K,i as V,s as we,b as me,d as Y,a as ve,c as ir}from"../chunks/kMYQBFqW.js";import{w as H}from"../chunks/DnlsI8hq.js";let Ie=!1;function Ce(){Ie||(Ie=!0,document.addEventListener("reset",e=>{Promise.resolve().then(()=>{var r;if(!e.defaultPrevented)for(const a of e.target.elements)(r=a.__on_r)==null||r.call(a)})},{capture:!0}))}function fr(e){var r=Me,a=ce;ee(null),re(null);try{return e()}finally{ee(r),re(a)}}function ur(e,r,a,t=a){e.addEventListener(r,()=>fr(a));const n=e.__on_r;n?e.__on_r=()=>{n(),t(!0)}:e.__on_r=()=>t(!0),Ce()}const le=0,J=1,ie=2;function cr(e,r,a,t,n){D&&Re();var o=e,i=Le(),v=He,f=be,p,s,c,u=(i?ae:de)(void 0),_=(i?ae:de)(void 0),d=!1;function k(l,h){d=!0,h&&(re(m),ee(m),ke(v));try{l===J&&t&&(s?_e(s):s=pe(()=>t(o,u))),l!==le&&p&&j(p,()=>p=null),l!==J&&s&&j(s,()=>s=null),l!==ie&&c&&j(c,()=>c=null)}finally{h&&(ke(null),ee(null),re(null),qe())}}var m=$e(()=>{if(f!==(f=r())){if(Oe(f)){var l=f;d=!1,l.then(h=>{l===f&&(Z(u,h),k(J,!0))},h=>{if(l===f)throw Z(_,h),k(ie,!0),_.v}),D||Be(()=>{d||k(le,!0)})}else Z(u,f),k(J,!1);return()=>f=be}});D&&(o=G)}function dr(e,r){return r}function vr(e,r,a,t){for(var n=[],o=r.length,i=0;i<o;i++)ze(r[i].e,n,!0);var v=o>0&&n.length===0&&a!==null;if(v){var f=a.parentNode;Ke(f),f.append(a),t.clear(),B(e,r[0].prev,r[o-1].next)}Qe(n,()=>{for(var p=0;p<o;p++){var s=r[p];v||(t.delete(s.k),B(e,s.prev,s.next)),Xe(s.e,!v)}})}function _r(e,r,a,t,n,o=null){var i=e,v={flags:r,items:new Map,first:null};D&&Re();var f=null,p=!1,s=We(()=>{var c=a();return er(c)?c:c==null?[]:Se(c)});$e(()=>{var c=y(s),u=c.length;if(p&&u===0)return;p=u===0;let _=!1;if(D){var d=i.data===Ge;d!==(u===0)&&(i=Ee(),xe(i),oe(!1),_=!0)}if(D){for(var k=null,m,l=0;l<u;l++){if(G.nodeType===8&&G.data===Ve){i=G,_=!0,oe(!1);break}var h=c[l],I=t(h,l);m=Pe(G,v,k,null,h,I,l,n,r,a),v.items.set(I,m),k=m}u>0&&xe(Ee())}D||pr(c,v,i,n,r,t,a),o!==null&&(u===0?f?_e(f):f=pe(()=>o(i)):f!==null&&j(f,()=>{f=null})),_&&oe(!0),y(s)}),D&&(i=G)}function pr(e,r,a,t,n,o,i){var v=e.length,f=r.items,p=r.first,s=p,c,u=null,_=[],d=[],k,m,l,h;for(h=0;h<v;h+=1){if(k=e[h],m=o(k,h),l=f.get(m),l===void 0){var I=s?s.e.nodes_start:a;u=Pe(I,r,u,u===null?r.first:u.next,k,m,h,t,n,i),f.set(m,u),_=[],d=[],s=u.next;continue}if(hr(l,k,h),(l.e.f&se)!==0&&_e(l.e),l!==s){if(c!==void 0&&c.has(l)){if(_.length<d.length){var A=d[0],x;u=A.prev;var S=_[0],O=_[_.length-1];for(x=0;x<_.length;x+=1)De(_[x],A,a);for(x=0;x<d.length;x+=1)c.delete(d[x]);B(r,S.prev,O.next),B(r,u,S),B(r,O,A),s=A,u=O,h-=1,_=[],d=[]}else c.delete(l),De(l,s,a),B(r,l.prev,l.next),B(r,l,u===null?r.first:u.next),B(r,u,l),u=l;continue}for(_=[],d=[];s!==null&&s.k!==m;)(s.e.f&se)===0&&(c??(c=new Set)).add(s),d.push(s),s=s.next;if(s===null)continue;l=s}_.push(l),u=l,s=l.next}if(s!==null||c!==void 0){for(var L=c===void 0?[]:Se(c);s!==null;)(s.e.f&se)===0&&L.push(s),s=s.next;var g=L.length;if(g>0){var $=null;vr(r,L,$,f)}}ce.first=r.first&&r.first.e,ce.last=u&&u.e}function hr(e,r,a,t){Z(e.v,r),e.i=a}function Pe(e,r,a,t,n,o,i,v,f,p){var s=(f&Je)!==0,c=(f&Ze)===0,u=s?c?de(n):ae(n):n,_=(f&Ye)===0?i:ae(i),d={i:_,v:u,k:o,a:null,e:null,prev:a,next:t};try{return d.e=pe(()=>v(e,u,_,p),D),d.e.prev=a&&a.e,d.e.next=t&&t.e,a===null?r.first=d:(a.next=d,a.e.next=d.e),t!==null&&(t.prev=d,t.e.prev=d.e),d}finally{}}function De(e,r,a){for(var t=e.next?e.next.e.nodes_start:a,n=r?r.e.nodes_start:a,o=e.e.nodes_start;o!==t;){var i=je(o);n.before(o),o=i}}function B(e,r,a){r===null?e.first=a:(r.next=a,r.e.next=a&&a.e),a!==null&&(a.prev=r,a.e.prev=r&&r.e)}const Ae=[...` 	
\r\fÂ \v\uFEFF`];function yr(e,r,a){var t=""+e;if(a){for(var n in a)if(a[n])t=t?t+" "+n:n;else if(t.length)for(var o=n.length,i=0;(i=t.indexOf(n,i))>=0;){var v=i+o;(i===0||Ae.includes(t[i-1]))&&(v===t.length||Ae.includes(t[v]))?t=(i===0?"":t.substring(0,i))+t.substring(v+1):i=v}}return t===""?null:t}function wr(e,r,a,t,n,o){var i=e.__className;if(D||i!==a){var v=yr(a,t,o);(!D||v!==e.getAttribute("class"))&&(v==null?e.removeAttribute("class"):e.className=v),e.__className=a}else if(o)for(var f in o){var p=!!o[f];(n==null||p!==!!n[f])&&e.classList.toggle(f,p)}return o}function mr(e){if(D){var r=!1,a=()=>{if(!r){if(r=!0,e.hasAttribute("value")){var t=e.value;ne(e,"value",null),e.value=t}if(e.hasAttribute("checked")){var n=e.checked;ne(e,"checked",null),e.checked=n}}};e.__on_r=a,rr(a),Ce()}}function gr(e,r){var a=e.__attributes??(e.__attributes={});a.value===(a.value=r??void 0)||e.value===r&&(r!==0||e.nodeName!=="PROGRESS")||(e.value=r??"")}function ne(e,r,a,t){var n=e.__attributes??(e.__attributes={});D&&(n[r]=e.getAttribute(r),r==="src"||r==="srcset"||r==="href"&&e.nodeName==="LINK")||n[r]!==(n[r]=a)&&(r==="style"&&"__styles"in e&&(e.__styles={}),r==="loading"&&(e[tr]=a),a==null?e.removeAttribute(r):typeof a!="string"&&br(e).includes(r)?e[r]=a:e.setAttribute(r,a))}var Ne=new Map;function br(e){var r=Ne.get(e.nodeName);if(r)return r;Ne.set(e.nodeName,r=[]);for(var a,t=e,n=Element.prototype;n!==t;){a=nr(t);for(var o in a)a[o].set&&r.push(o);t=ar(t)}return r}function kr(e,r,a=r){var t=Le();ur(e,"input",n=>{var o=n?e.defaultValue:e.value;if(o=fe(e)?ue(o):o,a(o),t&&o!==(o=r())){var i=e.selectionStart,v=e.selectionEnd;e.value=o??"",v!==null&&(e.selectionStart=i,e.selectionEnd=Math.min(v,e.value.length))}}),(D&&e.defaultValue!==e.value||or(r)==null&&e.value)&&a(fe(e)?ue(e.value):e.value),sr(()=>{var n=r();fe(e)&&n===ue(e.value)||e.type==="date"&&!n&&!e.value||n!==e.value&&(e.value=n??"")})}function fe(e){var r=e.type;return r==="number"||r==="range"}function ue(e){return e===""?null:+e}function Er(e){return new Worker(""+new URL("../workers/asyncDecompressWorker-pQRX2L1L.js",import.meta.url).href,{name:e==null?void 0:e.name})}function xr(e,r){const a=new Er;return new Promise((t,n)=>{a.onmessage=o=>{switch(o.data.type){case"progress":r(o.data.progress);break;case"result":r(1),t(o.data.result),a.terminate();break}},a.onerror=o=>{n(new Error(`Worker failed: ${o.message}`)),a.terminate()},a.postMessage(e)})}var Ir=M("<p> </p>"),Dr=M('<div><!> <progress class="svelte-1wojt58"></progress> <br> <button> </button></div>');function Ar(e,r){he(r,!0);const[a,t]=we(),n=()=>Y(v(),"$replayUrl",a),o=()=>Y(i(),"$matchId",a),i=K(r,"matchId",19,H),v=K(r,"replayUrl",19,H),f=K(r,"startedDownload",19,H),p=".dem",s=["Downloading replay...","Processing replay...","Finished"];let c=U(!1),u=U(-1),_,d=U(0);async function k(){b(c,!0),me(f(),!0);try{b(u,0);const E=await m();b(u,1);const w=await l(E);b(u,2),h(w),A()}catch{A(),b(u,-1)}}async function m(){_=new AbortController,b(d,0);let E=0,w=0;const N=await fetch("https://corsproxy.io/"+n(),{signal:_.signal});if(!N.ok)throw new Error("Network response was not ok");if(!N.body)throw new Error("Response body is null");const z=N.body.getReader();w=+(N.headers.get("Content-Length")||0),E=0;const T=[];for(;;){const{done:q,value:W}=await z.read();if(q)break;T.push(W),E+=W.length,b(d,E/w)}return await new Blob(T).arrayBuffer()}async function l(E){const w=new Uint8Array(E),N=await xr(w,z=>{b(d,ve(z))});return new Blob([N],{type:"application/octet-stream"})}function h(E){const w=document.createElement("a");w.href=URL.createObjectURL(E),w.download=o()+p,document.body.appendChild(w),w.click(),document.body.removeChild(w)}function I(){b(u,-1),_.abort(),A()}function A(){b(d,0),b(c,!1)}var x=Dr(),S=P(x);{var O=E=>{var w=Ir(),N=P(w,!0);F(w),Q(()=>X(N,s[y(u)])),R(E,w)};V(S,E=>{y(u)>=0&&E(O)})}var L=C(S,2);ne(L,"max",1);var g=C(L,4);g.__click=function(...E){var w;(w=y(c)?I:k)==null||w.apply(this,E)};var $=P(g,!0);F(g),F(x),Q(()=>{gr(L,y(d)),X($,y(c)?"Stop":"Download")}),R(e,x),ye(),t()}Ue(["click"]);function Nr(e,r,a,t,n,o){b(r,!0),b(a,ve(t()!=null&&/^[0-9]+$/.test(t().toString()))),b(o,ve(y(a)?`https://www.opendota.com/request#${t()}`:""))}async function Rr(e,r,a,t,n,o,i,v,f){if(!y(r)){b(a,!1),b(r,!0);try{const p=await fetch("https://api.opendota.com/api/matches/"+t());if(!p.ok)throw new Error("Network response was not ok");if(!p.body)throw new Error("Response body is null");const s=await p.json(),c=s.hasOwnProperty("replay_url")?s.replay_url:null;me(i(),c==null?null:new URL(c)),b(v,o()==null),b(r,!1),b(f,!0)}catch{b(r,!1),b(a,!0)}}}var Lr=M('<div>It seems that replay is not processed to download yet <br> Open generated link below and wait on opendota site until it finishes processing it <br> <a target="_blank" rel="noopener noreferrer"> </a> <br> Press again "Confirm" after opendota finishes processing</div>'),$r=M('<div style="color: green;">Replay is ready for next step</div>'),Sr=M("<!> <!>",1),Tr=M('<p style="color: red;">Invalid match id</p>'),Ur=M('<div><input type="number" placeholder="Paste your match id here"> <button> </button> <!> <!></div>');function Cr(e,r){he(r,!0);const[a,t]=we(),n=()=>Y(i(),"$matchId",a),o=()=>Y(v(),"$replayUrl",a),i=K(r,"matchId",19,H),v=K(r,"replayUrl",19,H);let f=U(!0),p=U(!1),s=U(!1),c=U(!1),u=Te(()=>()=>y(f)&&y(p)&&!y(s)),_=U(!1),d=U(!1),k=U("");var m=Ur(),l=P(m);mr(l),l.__input=[Nr,p,f,n,i,k];let h;var I=C(l,2);I.__click=[Rr,s,c,n,i,o,v,d,_];var A=P(I,!0);F(I);var x=C(I,2);{var S=g=>{var $=Sr(),E=te($);{var w=T=>{var q=Lr(),W=C(P(q),5),Fe=P(W,!0);F(W),lr(3),F(q),Q(()=>{ne(W,"href",y(k)),X(Fe,y(k))}),R(T,q)};V(E,T=>{y(d)&&T(w)})}var N=C(E,2);{var z=T=>{var q=$r();R(T,q)};V(N,T=>{y(d)||T(z)})}R(g,$)};V(x,g=>{y(_)&&g(S)})}var O=C(x,2);{var L=g=>{var $=Tr();R(g,$)};V(O,g=>{y(f)||g(L)})}F(m),Q(g=>{h=wr(l,1,"svelte-1sjc95f",null,h,{invalid:!y(f)}),I.disabled=g,X(A,y(c)?"Try again":"Confirm")},[()=>!y(u)()]),kr(l,n,g=>me(i(),g)),R(e,m),ye(),t()}Ue(["input","click"]);var Pr=M("<li><p> </p> <!></li>"),Fr=M('<ol><div style="display: flex; align-items: center;"></div> <!></ol>');function Mr(e,r){he(r,!0);const[a,t]=we(),n=()=>Y(f,"$replayUrl",a),o=()=>Y(p,"$startedDownload",a);let i=Te(()=>()=>[{text:"Enter your match id"},n()==null?null:{text:"Let it process and download"},o()==null?null:{text:"Paste it to your Dota 2 replay directory, e.g.: `C:\\Program Files (x86)\\Steam\\steamapps\\common\\dota 2 beta\\game\\dota\\replays\\`"},o()==null?null:{text:"Run game and find your replay in `watch` > `replays' > `saved to watch later` > `downloads`"}].filter(_=>_!=null)),v=H(),f=H(null),p=H();function s(_){return[Cr,Ar][_]}var c=Fr(),u=C(P(c),2);_r(u,17,()=>y(i)(),dr,(_,d,k)=>{var m=Pr(),l=P(m),h=P(l,!0);F(l);var I=C(l,2);cr(I,()=>Promise.resolve(s(k)),null,(A,x)=>{var S=ge(),O=te(S);{var L=g=>{var $=ge(),E=te($);ir(E,()=>y(x),(w,N)=>{N(w,{matchId:v,replayUrl:f,startedDownload:p})}),R(g,$)};V(O,g=>{y(x)&&g(L)})}R(A,S)}),F(m),Q(()=>X(h,y(d).text)),R(_,m)}),F(c),R(e,c),ye(),t()}var Or=M("<h1>OpenDotaReplayHandler</h1> <h2>Early super slow prototype edition</h2> <!>",1);function Yr(e){var r=Or(),a=C(te(r),4);Mr(a,{}),R(e,r)}export{Yr as component};
